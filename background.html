<html>
<script>
	chrome.tabs.onUpdated.addListener(
		function(tabId, changeInfo, tab) {
			if(tab.status == "loading" && tab.url.match(/^https?:.+$/i) != null){
				chrome.tabs.executeScript(tabId, {file: "xregexp-min.js"});
				chrome.tabs.executeScript(tabId, {file: "etl.js"});
				chrome.tabs.executeScript(tabId, {file: "document_end.1.js"});
			}
		});
	
	chrome.extension.onRequest.addListener(function(request, sender, sendResponse){
		if(request.name == "xmlviewer.getOptions")
			sendResponse( {"templateName": ( localStorage['templateName'] || "reduced")} );
		else if(request.name == "xmlviewer.setOptions"){
			localStorage['templateName'] = request.data['templateName'];
			sendResponse( true );
		}
	});
</script>
</html>
